{
  "version": 3,
  "sources": ["../../../src/lib/parsers/parser-415a-CellNodeStatus.ts"],
  "sourcesContent": ["import type * as utils from \"@iobroker/adapter-core\";\nimport { Parser } from \"binary-parser\";\nimport { ParserCommon } from \"./parser-common\";\nimport type { ParserInterface } from \"./parserinterface\";\n\ninterface Message_415a_CellNodeStatus_CellData {\n    ID: number;\n    USN: number;\n    MinCellVolt: number;\n    MaxCellVolt: number;\n    MinCellTemp: number;\n    BypassTemp: number;\n    BypassAmp: number;\n    Status: number;\n}\n\ninterface Message_415a_CellNodeStatus {\n    CmuRxOpStatusNodeID: number;\n    Records: number;\n    FirstNodeID: number;\n    LastNodeID: number;\n    nodes: Array<Message_415a_CellNodeStatus_CellData>;\n}\n\nexport class Parser_415a_CellNodeStatus extends ParserCommon implements ParserInterface {\n    private parser: Parser;\n    private subParser: Parser;\n    private initializedCellNodes: Array<number> = [];\n\n    public constructor(adapter: utils.AdapterInstance) {\n        super(adapter);\n        // Category    = Telemetry\n        // Object      = CellNodeItem\n        // Description = Cell node - array up to 16 nodes\n        // MsgLength   = variable\n        // Version     = 1\n        // Frequency   = 300 mS\n        // Support     = Current\n        // Valid to    = SW 1.0.29\n        this.adapter = adapter;\n        this.messageId = \"415a\";\n        this.messageName = \"Cell Node Status Limited\";\n        this.subParser = new Parser()\n            .uint8(\"ID\")\n            .uint8(\"USN\")\n            .int16le(\"MinCellVolt\", {\n                formatter: x => {\n                    return x / 1000;\n                },\n            })\n            .int16le(\"MaxCellVolt\", {\n                formatter: x => {\n                    return x / 1000;\n                },\n            })\n            .uint8(\"MinCellTemp\", {\n                formatter: x => {\n                    return x - 40;\n                },\n            }) // temperature \u00BAC\n            .uint8(\"BypassTemp\", {\n                formatter: x => {\n                    return x - 40;\n                },\n            }) // temperature \u00BAC\n            .int16le(\"BypassAmp\", {\n                formatter: x => {\n                    return x / 1000;\n                },\n            })\n            .uint8(\"Status\"); /* Choices NodeStatuses\n                None = 0,\n                HighVolt = 1,\n                HighTemp = 2,\n                Ok = 3,\n                Timeout = 4,\n                LowVolt = 5,\n                Disabled = 6,\n                InBypass = 7,\n                InitialBypass = 8,\n                FinalBypass = 9,\n                MissingSetup = 10,\n                NoConfig = 11,\n                CellOutLimits = 12, */\n\n        this.parser = new Parser()\n            .skip(8)\n            .uint8(\"CmuRxOpStatusNodeID\")\n            .uint8(\"Records\")\n            .uint8(\"FirstNodeID\")\n            .uint8(\"LastNodeID\")\n            .array(\"nodes\", {\n                type: this.subParser,\n                length: \"Records\",\n            });\n    }\n\n    public initObjects(_systemId: number): void {\n        return;\n    }\n\n    private async initCellNode(systemId: number, id: number): Promise<void> {\n        this.adapter.log.debug(`Setting Cell${id}`);\n        await this.adapter?.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}`), {\n            type: \"device\",\n            common: {\n                name: `Batrium Cell #${id.toString()}`,\n            },\n            native: {},\n        });\n        await Promise.all([\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.ID`), {\n                type: \"state\",\n                common: {\n                    name: \"ID\",\n                    type: \"number\",\n                    role: \"info.address\",\n                    read: true,\n                    write: false,\n                },\n                native: {},\n            }),\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.USN`), {\n                type: \"state\",\n                common: {\n                    name: \"USN\",\n                    type: \"number\",\n                    role: \"value\",\n                    read: true,\n                    write: false,\n                },\n                native: {},\n            }),\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.MinCellVolt`), {\n                type: \"state\",\n                common: {\n                    name: \"MinCellVolt\",\n                    type: \"number\",\n                    role: \"value.voltage\",\n                    read: true,\n                    write: false,\n                    unit: \"V\",\n                },\n                native: {},\n            }),\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.MaxCellVolt`), {\n                type: \"state\",\n                common: {\n                    name: \"MaxCellVolt\",\n                    type: \"number\",\n                    role: \"value.voltage\",\n                    read: true,\n                    write: false,\n                    unit: \"V\",\n                },\n                native: {},\n            }),\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.MinCellTemp`), {\n                type: \"state\",\n                common: {\n                    name: \"MinCellTemp\",\n                    type: \"number\",\n                    role: \"value.temperature\",\n                    read: true,\n                    write: false,\n                    unit: \"\u00B0C\",\n                },\n                native: {},\n            }),\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.BypassTemp`), {\n                type: \"state\",\n                common: {\n                    name: \"BypassTemp\",\n                    type: \"number\",\n                    role: \"value.temperature\",\n                    read: true,\n                    write: false,\n                    unit: \"\u00B0C\",\n                },\n                native: {},\n            }),\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.BypassAmp`), {\n                type: \"state\",\n                common: {\n                    name: \"BypassAmp\",\n                    type: \"number\",\n                    role: \"value.current\",\n                    read: true,\n                    write: false,\n                    unit: \"A\",\n                },\n                native: {},\n            }),\n            this.adapter.setObjectNotExistsAsync(this.getVariableName(systemId, `${id}.Status`), {\n                type: \"state\",\n                common: {\n                    name: \"Status\",\n                    type: \"number\",\n                    role: \"info.status\",\n                    read: true,\n                    write: false,\n                    states: {\n                        0: \"None\",\n                        1: \"HighVolt\",\n                        2: \"HighTemp\",\n                        3: \"OK\",\n                        4: \"Timeout\",\n                        5: \"LowVolt\",\n                        6: \"Disabled\",\n                        7: \"InBypass\",\n                        8: \"InitialBypass\",\n                        9: \"FinalBypass\",\n                        10: \"MissingSetup\",\n                        11: \"NoConfig\",\n                        12: \"CellOutLimits\",\n                    },\n                },\n                native: {},\n            }),\n        ]);\n    }\n\n    private setCellValues(systemId: number, cellData: Message_415a_CellNodeStatus_CellData): void {\n        void this.adapter.setStateChangedAsync(this.getVariableName(systemId, `${cellData.ID}.ID`), cellData.ID, true);\n        void this.adapter.setStateChangedAsync(\n            this.getVariableName(systemId, `${cellData.ID}.USN`),\n            cellData.USN,\n            true,\n        );\n        void this.adapter.setStateChangedAsync(\n            this.getVariableName(systemId, `${cellData.ID}.MinCellVolt`),\n            cellData.MinCellVolt,\n            true,\n        );\n        void this.adapter.setStateChangedAsync(\n            this.getVariableName(systemId, `${cellData.ID}.MaxCellVolt`),\n            cellData.MaxCellVolt,\n            true,\n        );\n        void this.adapter.setStateChangedAsync(\n            this.getVariableName(systemId, `${cellData.ID}.MinCellTemp`),\n            cellData.MinCellTemp,\n            true,\n        );\n        void this.adapter.setStateChangedAsync(\n            this.getVariableName(systemId, `${cellData.ID}.BypassTemp`),\n            cellData.BypassTemp,\n            true,\n        );\n        void this.adapter.setStateChangedAsync(\n            this.getVariableName(systemId, `${cellData.ID}.BypassAmp`),\n            cellData.BypassAmp,\n            true,\n        );\n        void this.adapter.setStateChangedAsync(\n            this.getVariableName(systemId, `${cellData.ID}.Status`),\n            cellData.Status,\n            true,\n        );\n    }\n\n    public handleMessage(systemId: number, msg: Buffer): void {\n        if (!this.adapter.config[\"415a_active\"] || this.ratelimitTimeout) {\n            return;\n        }\n        this.ratelimitTimeout = this.adapter.setTimeout(() => {\n            this.ratelimitTimeout = undefined;\n        }, this.adapter.config[\"415a_ratelimit\"]);\n        const result: Message_415a_CellNodeStatus = this.parser.parse(msg);\n        result.nodes.forEach(async nodeData => {\n            if (!this.initializedCellNodes.includes(nodeData.ID)) {\n                await this.initCellNode(systemId, nodeData.ID);\n                this.initializedCellNodes.push(nodeData.ID);\n            }\n        });\n        result.nodes.forEach(nodeData => {\n            this.setCellValues(systemId, nodeData);\n        });\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,2BAAuB;AACvB,2BAA6B;AAsBtB,MAAM,mCAAmC,kCAAwC;AAAA,EAC5E;AAAA,EACA;AAAA,EACA,uBAAsC,CAAC;AAAA,EAExC,YAAY,SAAgC;AAC/C,UAAM,OAAO;AASb,SAAK,UAAU;AACf,SAAK,YAAY;AACjB,SAAK,cAAc;AACnB,SAAK,YAAY,IAAI,4BAAO,EACvB,MAAM,IAAI,EACV,MAAM,KAAK,EACX,QAAQ,eAAe;AAAA,MACpB,WAAW,OAAK;AACZ,eAAO,IAAI;AAAA,MACf;AAAA,IACJ,CAAC,EACA,QAAQ,eAAe;AAAA,MACpB,WAAW,OAAK;AACZ,eAAO,IAAI;AAAA,MACf;AAAA,IACJ,CAAC,EACA,MAAM,eAAe;AAAA,MAClB,WAAW,OAAK;AACZ,eAAO,IAAI;AAAA,MACf;AAAA,IACJ,CAAC,EACA,MAAM,cAAc;AAAA,MACjB,WAAW,OAAK;AACZ,eAAO,IAAI;AAAA,MACf;AAAA,IACJ,CAAC,EACA,QAAQ,aAAa;AAAA,MAClB,WAAW,OAAK;AACZ,eAAO,IAAI;AAAA,MACf;AAAA,IACJ,CAAC,EACA,MAAM,QAAQ;AAenB,SAAK,SAAS,IAAI,4BAAO,EACpB,KAAK,CAAC,EACN,MAAM,qBAAqB,EAC3B,MAAM,SAAS,EACf,MAAM,aAAa,EACnB,MAAM,YAAY,EAClB,MAAM,SAAS;AAAA,MACZ,MAAM,KAAK;AAAA,MACX,QAAQ;AAAA,IACZ,CAAC;AAAA,EACT;AAAA,EAEO,YAAY,WAAyB;AACxC;AAAA,EACJ;AAAA,EAEA,MAAc,aAAa,UAAkB,IAA2B;AArG5E;AAsGQ,SAAK,QAAQ,IAAI,MAAM,eAAe,EAAE,EAAE;AAC1C,YAAM,UAAK,YAAL,mBAAc,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,EAAE,GAAG;AAAA,MACjF,MAAM;AAAA,MACN,QAAQ;AAAA,QACJ,MAAM,iBAAiB,GAAG,SAAS,CAAC;AAAA,MACxC;AAAA,MACA,QAAQ,CAAC;AAAA,IACb;AACA,UAAM,QAAQ,IAAI;AAAA,MACd,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,KAAK,GAAG;AAAA,QAC7E,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,QACX;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,MACD,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,MAAM,GAAG;AAAA,QAC9E,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,QACX;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,MACD,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,cAAc,GAAG;AAAA,QACtF,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QACV;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,MACD,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,cAAc,GAAG;AAAA,QACtF,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QACV;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,MACD,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,cAAc,GAAG;AAAA,QACtF,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QACV;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,MACD,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,aAAa,GAAG;AAAA,QACrF,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QACV;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,MACD,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,YAAY,GAAG;AAAA,QACpF,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QACV;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,MACD,KAAK,QAAQ,wBAAwB,KAAK,gBAAgB,UAAU,GAAG,EAAE,SAAS,GAAG;AAAA,QACjF,MAAM;AAAA,QACN,QAAQ;AAAA,UACJ,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,QAAQ;AAAA,YACJ,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,GAAG;AAAA,YACH,IAAI;AAAA,YACJ,IAAI;AAAA,YACJ,IAAI;AAAA,UACR;AAAA,QACJ;AAAA,QACA,QAAQ,CAAC;AAAA,MACb,CAAC;AAAA,IACL,CAAC;AAAA,EACL;AAAA,EAEQ,cAAc,UAAkB,UAAsD;AAC1F,SAAK,KAAK,QAAQ,qBAAqB,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,KAAK,GAAG,SAAS,IAAI,IAAI;AAC7G,SAAK,KAAK,QAAQ;AAAA,MACd,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,MAAM;AAAA,MACnD,SAAS;AAAA,MACT;AAAA,IACJ;AACA,SAAK,KAAK,QAAQ;AAAA,MACd,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,cAAc;AAAA,MAC3D,SAAS;AAAA,MACT;AAAA,IACJ;AACA,SAAK,KAAK,QAAQ;AAAA,MACd,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,cAAc;AAAA,MAC3D,SAAS;AAAA,MACT;AAAA,IACJ;AACA,SAAK,KAAK,QAAQ;AAAA,MACd,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,cAAc;AAAA,MAC3D,SAAS;AAAA,MACT;AAAA,IACJ;AACA,SAAK,KAAK,QAAQ;AAAA,MACd,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,aAAa;AAAA,MAC1D,SAAS;AAAA,MACT;AAAA,IACJ;AACA,SAAK,KAAK,QAAQ;AAAA,MACd,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,YAAY;AAAA,MACzD,SAAS;AAAA,MACT;AAAA,IACJ;AACA,SAAK,KAAK,QAAQ;AAAA,MACd,KAAK,gBAAgB,UAAU,GAAG,SAAS,EAAE,SAAS;AAAA,MACtD,SAAS;AAAA,MACT;AAAA,IACJ;AAAA,EACJ;AAAA,EAEO,cAAc,UAAkB,KAAmB;AACtD,QAAI,CAAC,KAAK,QAAQ,OAAO,aAAa,KAAK,KAAK,kBAAkB;AAC9D;AAAA,IACJ;AACA,SAAK,mBAAmB,KAAK,QAAQ,WAAW,MAAM;AAClD,WAAK,mBAAmB;AAAA,IAC5B,GAAG,KAAK,QAAQ,OAAO,gBAAgB,CAAC;AACxC,UAAM,SAAsC,KAAK,OAAO,MAAM,GAAG;AACjE,WAAO,MAAM,QAAQ,OAAM,aAAY;AACnC,UAAI,CAAC,KAAK,qBAAqB,SAAS,SAAS,EAAE,GAAG;AAClD,cAAM,KAAK,aAAa,UAAU,SAAS,EAAE;AAC7C,aAAK,qBAAqB,KAAK,SAAS,EAAE;AAAA,MAC9C;AAAA,IACJ,CAAC;AACD,WAAO,MAAM,QAAQ,cAAY;AAC7B,WAAK,cAAc,UAAU,QAAQ;AAAA,IACzC,CAAC;AAAA,EACL;AACJ;",
  "names": []
}

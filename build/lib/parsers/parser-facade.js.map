{
  "version": 3,
  "sources": ["../../../src/lib/parsers/parser-facade.ts"],
  "sourcesContent": ["import type * as utils from \"@iobroker/adapter-core\";\nimport type { ParserInterface } from \"./parserinterface\";\nimport type { MessageBaseData } from \"./parser-base-data\";\nimport { ParserBaseData } from \"./parser-base-data\";\nimport { Parser_5732_SystemDiscovery } from \"./parser-5732-SystemDiscovery\";\nimport { Parser_3233_LiveDisplay } from \"./parser-3233-LiveDisplay\";\nimport { Parser_6831_QuickSessionHist } from \"./parser-6831-QuickSessionHist\";\nimport { Parser_415a_CellNodeStatus } from \"./parser-415a-CellNodeStatus\";\nimport { Parser_4232_CellNodeFull } from \"./parser-4232-CellNodeFull\";\n\nexport class ParserFacade {\n    private parserMap: Map<string, ParserInterface>;\n    private adapter: utils.AdapterInstance;\n    private parserBaseData: ParserBaseData;\n    private knownSystems: Array<string> = [];\n    private knownSystemMessages: Array<string> = [];\n\n    public constructor(adapter: utils.AdapterInstance) {\n        this.adapter = adapter;\n        this.parserBaseData = new ParserBaseData();\n        this.parserMap = new Map<string, ParserInterface>();\n        this.parserMap.set(\"3233\", new Parser_3233_LiveDisplay(this.adapter));\n        this.parserMap.set(\"415a\", new Parser_415a_CellNodeStatus(this.adapter));\n        this.parserMap.set(\"4232\", new Parser_4232_CellNodeFull(this.adapter));\n        this.parserMap.set(\"5732\", new Parser_5732_SystemDiscovery(this.adapter));\n        this.parserMap.set(\"6831\", new Parser_6831_QuickSessionHist(this.adapter));\n    }\n\n    public getMessageBaseData(buf: Buffer): MessageBaseData {\n        return this.parserBaseData.parse(buf);\n    }\n\n    private async createSystemNode(systemId: number): Promise<void> {\n        await this.adapter?.setObjectNotExistsAsync(\n            `${this.adapter?.name}.${this.adapter.instance!.toString()}.${systemId.toString()}`,\n            {\n                type: \"device\",\n                common: {\n                    name: `Batrium Device #${systemId.toString()}`,\n                },\n                native: {},\n            },\n        );\n    }\n\n    private async createSystemMessageNode(systemId: number, messageId: string): Promise<void> {\n        await this.adapter?.setObjectNotExistsAsync(\n            `${this.adapter?.name}.${this.adapter.instance!.toString()}.${systemId.toString()}.${messageId}`,\n            {\n                type: \"channel\",\n                common: {\n                    name: this.parserMap.get(messageId)?.getMessageName() ?? \"Unknown Type\",\n                },\n                native: {},\n            },\n        );\n    }\n\n    public async handleMessage(systemId: number, messageID: string, msg: Buffer): Promise<boolean> {\n        if (!this.parserMap.has(messageID)) {\n            this.adapter.log.debug(`Unknown MessageID ${messageID} received`);\n            return false;\n        }\n        if (!this.knownSystems.includes(systemId.toString())) {\n            this.adapter.log.debug(`Unknown SystemID ${systemId} received. Creating...`);\n            await this.createSystemNode(systemId);\n            this.adapter.log.debug(`Done`);\n            this.knownSystems.push(systemId.toString());\n        }\n        const cachekey = `${systemId.toString()}.${messageID}`;\n        if (!this.knownSystemMessages.includes(cachekey)) {\n            this.adapter.log.debug(`Object Node ${cachekey} not existing. Creating...`);\n            await this.createSystemMessageNode(systemId, messageID);\n            await this.parserMap.get(messageID)?.initObjects(systemId);\n            this.adapter.log.debug(`Done`);\n            this.knownSystemMessages.push(cachekey);\n        }\n        this.adapter.log.debug(`Delegating Message of type ${cachekey} to Parser.`);\n        return !!this.parserMap.get(messageID)?.handleMessage(systemId, msg);\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
